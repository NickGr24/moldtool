{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{% trans "Închiriere" %} {{ tool.name }} - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs">
        <span class="breadcrumbs-item"><a href="{% url 'core:home' %}">Acasă</a></span>
        <span class="breadcrumbs-separator">/</span>
        <span class="breadcrumbs-item"><a href="{% url 'catalog:catalog' %}">Catalog</a></span>
        <span class="breadcrumbs-separator">/</span>
        <span class="breadcrumbs-item"><a href="{{ tool.get_absolute_url }}">{{ tool.name }}</a></span>
        <span class="breadcrumbs-separator">/</span>
        <span class="breadcrumbs-item active">Procesare închiriere</span>
    </nav>

    <h1 class="mb-lg text-center">Procesare închiriere</h1>

    <div class="rental-form">
        <!-- Tool Info Header -->
        <div class="rental-form-header">
            <div class="rental-form-tool-image">
                {% if tool.image %}
                <img src="{{ tool.image.url }}" alt="{{ tool.name }}">
                {% else %}
                <img src="{% static 'images/placeholder.jpg' %}" alt="{{ tool.name }}">
                {% endif %}
            </div>
            <div class="rental-form-tool-info">
                <h3>{{ tool.name }}</h3>
                <p>{{ tool.price_per_day }} MDL / Zi</p>
            </div>
        </div>

        <form method="post" novalidate>
            {% csrf_token %}

            <!-- Customer Info -->
            <div class="form-group">
                <label class="form-label required" for="id_customer_name">Numele dumneavoastră</label>
                <input type="text" name="customer_name" id="id_customer_name"
                       class="form-control {% if form.customer_name.errors %}is-invalid{% endif %}"
                       value="{{ form.customer_name.value|default:'' }}"
                       placeholder="{% trans "Ion Popescu" %}" required>
                {% if form.customer_name.errors %}
                <p class="form-error">{{ form.customer_name.errors.0 }}</p>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label required" for="id_customer_email">Email</label>
                <input type="email" name="customer_email" id="id_customer_email"
                       class="form-control {% if form.customer_email.errors %}is-invalid{% endif %}"
                       value="{{ form.customer_email.value|default:'' }}"
                       placeholder="email@example.com" required>
                {% if form.customer_email.errors %}
                <p class="form-error">{{ form.customer_email.errors.0 }}</p>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label required" for="id_customer_phone">Telefon</label>
                <input type="tel" name="customer_phone" id="id_customer_phone"
                       class="form-control {% if form.customer_phone.errors %}is-invalid{% endif %}"
                       value="{{ form.customer_phone.value|default:'' }}"
                       placeholder="+373 XX XXX XXX" required>
                {% if form.customer_phone.errors %}
                <p class="form-error">{{ form.customer_phone.errors.0 }}</p>
                {% endif %}
            </div>

            <!-- Dates -->
            <div class="rental-dates">
                <div class="form-group">
                    <label class="form-label required" for="id_start_date">Data de început</label>
                    <input type="date" name="start_date" id="id_start_date"
                           class="form-control {% if form.start_date.errors %}is-invalid{% endif %}"
                           value="{{ form.start_date.value|default:'' }}" required>
                    {% if form.start_date.errors %}
                    <p class="form-error">{{ form.start_date.errors.0 }}</p>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label required" for="id_end_date">Data de sfârșit</label>
                    <input type="date" name="end_date" id="id_end_date"
                           class="form-control {% if form.end_date.errors %}is-invalid{% endif %}"
                           value="{{ form.end_date.value|default:'' }}" required>
                    {% if form.end_date.errors %}
                    <p class="form-error">{{ form.end_date.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Comment -->
            <div class="form-group">
                <label class="form-label" for="id_comment">Comentariu</label>
                <textarea name="comment" id="id_comment" class="form-control" rows="3"
                          placeholder="{% trans "Dorințe suplimentare..." %}">{{ form.comment.value|default:'' }}</textarea>
            </div>

            <!-- Price Summary -->
            <div class="rental-summary" data-price-per-day="{{ tool.price_per_day|default:0 }}" data-deposit="{{ tool.deposit|default:0 }}">
                <div class="rental-summary-row">
                    <span>Pret pe zi</span>
                    <span>{{ tool.price_per_day }} MDL</span>
                </div>
                <div class="rental-summary-row">
                    <span>Număr de zile</span>
                    <span id="totalDays">-</span>
                </div>
                {% if tool.deposit %}
                <div class="rental-summary-row">
                    <span>Depozit</span>
                    <span id="depositAmount">{{ tool.deposit }} MDL</span>
                </div>
                {% endif %}
                <div class="rental-summary-row">
                    <span>Total de plată</span>
                    <span id="totalPrice">-</span>
                </div>
            </div>

            {% if form.non_field_errors %}
            <div class="alert alert-error">
                {% for error in form.non_field_errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}

            <button type="submit" class="btn btn-primary btn-lg btn-block">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                {% trans "Trimite cererea" %}
            </button>
        </form>

        <p class="text-center text-muted mt-lg" style="font-size: var(--font-size-sm);">
            {% trans "Trimițând cererea, sunteți de acord cu condițiile de închiriere" %}
        </p>
    </div>
</div>
{% endblock %}
