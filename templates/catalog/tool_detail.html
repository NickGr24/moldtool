{% extends 'base.html' %}
{% load static %}

{% block title %}{{ tool.name }} - {{ SITE_NAME }}{% endblock %}

{% block meta_description %}{{ tool.short_description|default:tool.description|truncatewords:30 }}{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs">
        <span class="breadcrumbs-item"><a href="{% url 'core:home' %}">Главная</a></span>
        <span class="breadcrumbs-separator">/</span>
        <span class="breadcrumbs-item"><a href="{% url 'catalog:catalog' %}">Каталог</a></span>
        <span class="breadcrumbs-separator">/</span>
        <span class="breadcrumbs-item"><a href="{{ tool.category.get_absolute_url }}">{{ tool.category.name }}</a></span>
        <span class="breadcrumbs-separator">/</span>
        <span class="breadcrumbs-item active">{{ tool.name }}</span>
    </nav>

    <!-- Tool Detail -->
    <div class="tool-detail">
        <!-- Gallery -->
        <div class="tool-gallery">
            <div class="tool-gallery-main">
                {% if tool.image %}
                <img src="{{ tool.image.url }}" alt="{{ tool.name }}">
                {% else %}
                <img src="{% static 'images/placeholder.jpg' %}" alt="{{ tool.name }}">
                {% endif %}
            </div>

            {% if tool.images.exists %}
            <div class="tool-gallery-thumbs">
                <div class="tool-gallery-thumb active">
                    <img src="{{ tool.image.url }}" alt="{{ tool.name }}">
                </div>
                {% for image in tool.images.all %}
                <div class="tool-gallery-thumb">
                    <img src="{{ image.image.url }}" alt="{{ image.alt_text|default:tool.name }}">
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Info -->
        <div class="tool-info">
            <span class="tool-category">{{ tool.category.name }}</span>
            <h1 class="tool-title">{{ tool.name }}</h1>

            {% if tool.brand %}
            <p class="tool-brand">{{ tool.brand }}{% if tool.model_name %} {{ tool.model_name }}{% endif %}</p>
            {% endif %}

            <!-- Price Block -->
            <div class="tool-price-block">
                <div class="tool-price">
                    {{ tool.price_per_day }} MDL <span>/ день</span>
                </div>
                {% if tool.deposit %}
                <p class="tool-deposit">Залог: {{ tool.deposit }} MDL</p>
                {% endif %}
            </div>

            <!-- Availability -->
            <div class="tool-availability {% if not tool.is_available %}rented{% endif %}">
                {% if tool.is_available %}
                <span class="status-available">Доступен для аренды</span>
                {% else %}
                <span class="status-rented">Сейчас в аренде</span>
                {% endif %}
            </div>

            <!-- Actions -->
            <div class="tool-actions">
                {% if tool.is_available %}
                <a href="{% url 'rentals:create_request' tool_slug=tool.slug %}" class="btn btn-primary btn-lg">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Арендовать
                </a>
                {% else %}
                <button class="btn btn-secondary btn-lg" disabled>Недоступен</button>
                {% endif %}
                <a href="tel:{{ SITE_PHONE }}" class="btn btn-outline btn-lg">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                    Позвонить
                </a>
            </div>

            <!-- Specifications -->
            {% if tool.specifications %}
            <div class="tool-specs">
                <h3 class="tool-specs-title">Характеристики</h3>
                <div class="tool-specs-list">
                    {% for key, value in tool.specifications.items %}
                    <div class="tool-specs-item">
                        <span>{{ key }}</span>
                        <span>{{ value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Description -->
    <div class="tool-description">
        <h3>Описание</h3>
        <p>{{ tool.description|linebreaks }}</p>
    </div>

    <!-- Related Tools -->
    {% if related_tools %}
    <section class="section">
        <h2 class="section-title">Похожие инструменты</h2>
        <div class="tools-grid">
            {% for related in related_tools %}
            <div class="card tool-card">
                <a href="{{ related.get_absolute_url }}" class="card-image">
                    {% if related.image %}
                    <img src="{{ related.image.url }}" alt="{{ related.name }}">
                    {% else %}
                    <img src="{% static 'images/placeholder.jpg' %}" alt="{{ related.name }}">
                    {% endif %}
                </a>
                <div class="card-body">
                    <h3 class="card-title">
                        <a href="{{ related.get_absolute_url }}">{{ related.name }}</a>
                    </h3>
                    <div class="card-price">
                        {{ related.price_per_day }} MDL <span>/ день</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}
